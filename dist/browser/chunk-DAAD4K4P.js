import{a as s}from"./chunk-4MJ6IACY.js";import{Oc as p,a as o,aa as a,da as l,ja as g}from"./chunk-Q5RHU532.js";var f=class i{http=g(p);AUTH_TOKEN_KEY="auth_token";USER_INFO_KEY="user_info";MFA_TEMP_USER_KEY="mfa_temp_user";login(t){return this.http.post(`${s.apiUrl}/auth/login`,t).pipe(a(e=>{if(e.status==="success"){if(e.data?.requireMfa)localStorage.setItem(this.MFA_TEMP_USER_KEY,JSON.stringify(e.data)),e.data.tempToken&&localStorage.setItem(this.AUTH_TOKEN_KEY,e.data.tempToken);else if(e.data?.token){localStorage.setItem(this.AUTH_TOKEN_KEY,e.data.token);let r=o({},e.data);delete r.token,localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(r))}}}))}forgotPassword(t){return this.http.post(`${s.apiUrl}/auth/forgot-password`,{email:t})}resetPassword(t,e){return this.http.post(`${s.apiUrl}/auth/reset-password/${t}`,{password:e})}registerAdmin(t,e){return this.http.post(`${s.apiUrl}/auth/register/${t}`,e).pipe(a(r=>{if(r.status==="success"&&r.data?.token){localStorage.setItem(this.AUTH_TOKEN_KEY,r.data.token);let n=o({},r.data);delete n.token,localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(n))}}))}isManager(){return this.getCurrentUser()?.role==="manager"}isStaff(){return this.getCurrentUser()?.role==="staff"}isAdminOrSuperAdmin(){let t=this.getCurrentUser();return t?.role==="admin"||t?.role==="superadmin"}getMfaSetup(){return this.http.get(`${s.apiUrl}/mfa/setup`)}getCurrentUser(){let t=localStorage.getItem(this.USER_INFO_KEY);return t?JSON.parse(t):null}verifyMfaSetup(t){return this.http.post(`${s.apiUrl}/mfa/verify-setup`,{code:t}).pipe(a(e=>{if(e.status==="success"&&e.data?.token){localStorage.setItem(this.AUTH_TOKEN_KEY,e.data.token);let r=this.getTempUserInfo();r&&(delete r.tempToken,delete r.requireMfa,delete r.mfaSetupRequired,localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(r))),localStorage.removeItem(this.MFA_TEMP_USER_KEY)}}))}verifyMfaLogin(t){let e=this.getTempUserInfo();return this.http.post(`${s.apiUrl}/mfa/verify`,{userId:e?._id,code:t}).pipe(a(r=>{r.status==="success"&&r.data?.token&&(localStorage.setItem(this.AUTH_TOKEN_KEY,r.data.token),e&&(delete e.tempToken,delete e.requireMfa,delete e.mfaSetupRequired,localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e))),localStorage.removeItem(this.MFA_TEMP_USER_KEY))}))}getTempUserInfo(){let t=localStorage.getItem(this.MFA_TEMP_USER_KEY);return t?JSON.parse(t):null}isMfaRequired(){return!!localStorage.getItem(this.MFA_TEMP_USER_KEY)}logout(){localStorage.removeItem(this.AUTH_TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),localStorage.removeItem(this.MFA_TEMP_USER_KEY)}getToken(){return localStorage.getItem(this.AUTH_TOKEN_KEY)}isLoggedIn(){return!!this.getToken()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a};
