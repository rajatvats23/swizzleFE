import{b as Q}from"./chunk-SWI6467K.js";import{a as A,c as B,d as R}from"./chunk-2D2I2PDG.js";import{b as N,c as O,d as P,i as k}from"./chunk-PTRNPYW6.js";import{a as D}from"./chunk-URY737FD.js";import{b as y,d as u,g as S,h as I,i as F,k as E,m as V,p as q,s as L,v as T,y as w}from"./chunk-NZ7PJTNX.js";import"./chunk-75BXHIVP.js";import{a as b}from"./chunk-NQCP3IVX.js";import"./chunk-LK7ZGARP.js";import{q as U,u as G}from"./chunk-FE5XWYP3.js";import"./chunk-GTI6TFUP.js";import{a as x,c as _}from"./chunk-VSTSZJ55.js";import{Cc as v,Fb as h,Gb as l,Kc as C,Ra as c,Rb as r,Sb as M,Ta as a,cb as g,hb as d,ja as p,ob as s,xb as o,yb as n,zb as f}from"./chunk-KAD4X6AH.js";function j(e,t){e&1&&(o(0,"p"),r(1,"Enter the 6-digit code from your authenticator app"),n())}function H(e,t){if(e&1&&f(0,"img",12),e&2){let i=l(2);s("src",i.qrCodeUrl,c)}}function J(e,t){if(e&1&&(o(0,"div",8)(1,"p"),r(2,"Scan this QR code with your authenticator app"),n(),o(3,"div",9),d(4,H,1,1,"img",10),n(),o(5,"p",11),r(6," 1. Install Google Authenticator app"),f(7,"br"),r(8," 2. Scan this QR code"),f(9,"br"),r(10," 3. Enter the 6-digit code below to confirm setup "),n()()),e&2){let i=l();a(4),s("ngIf",i.qrCodeUrl)}}function $(e,t){e&1&&(o(0,"mat-error"),r(1,"Code is required"),n())}function K(e,t){e&1&&(o(0,"mat-error"),r(1,"Must be 6 digits"),n())}function W(e,t){e&1&&(o(0,"span"),r(1,"Verifying..."),n())}function X(e,t){if(e&1&&(o(0,"span"),r(1),n()),e&2){let i=l();a(),M(i.setupMode?"Confirm Setup":"Verify")}}var z=class e{router=p(_);route=p(x);authService=p(b);snackBar=p(D);isLoading=!1;setupMode=!1;qrCodeUrl="";mfaForm=new F({code:new E("",[u.required,u.pattern(/^\d{6}$/)])});ngOnInit(){let t=this.router.getCurrentNavigation();if(t?.extras.state&&t.extras.state.setupMode)this.setupMode=!0;else{let i=this.authService.getTempUserInfo();this.setupMode=i?.mfaSetupRequired===!0}if(!this.authService.isMfaRequired()){this.router.navigate(["/auth/login"]);return}this.setupMode&&this.fetchQrCode()}fetchQrCode(){this.isLoading=!0,this.authService.getMfaSetup().subscribe({next:t=>{this.qrCodeUrl=t.data.qrCodeUrl,this.isLoading=!1},error:t=>{this.isLoading=!1,this.snackBar.open(t.error?.message||"Failed to get MFA setup","Close",{duration:5e3}),this.router.navigate(["/auth/login"])}})}onSubmit(){if(this.mfaForm.valid){this.isLoading=!0;let t=this.mfaForm.value.code||"";this.setupMode?this.authService.verifyMfaSetup(t).subscribe({next:i=>{this.isLoading=!1,this.snackBar.open("MFA setup successful","Close",{duration:3e3}),this.router.navigate(["/dashboard"])},error:i=>{this.isLoading=!1,this.snackBar.open(i.error?.message||"Invalid code","Close",{duration:5e3})}}):this.authService.verifyMfaLogin(t).subscribe({next:i=>{this.isLoading=!1,this.snackBar.open("Authentication successful","Close",{duration:3e3}),this.router.navigate(["/dashboard"])},error:i=>{this.isLoading=!1,this.snackBar.open(i.error?.message||"Invalid code","Close",{duration:5e3})}})}}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=g({type:e,selectors:[["app-mfa-verify"]],decls:17,vars:8,consts:[[1,"auth-content"],[1,"top-label"],[4,"ngIf"],["class","mfa-setup",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","code","type","text","autocomplete","off","maxlength","6"],["mat-flat-button","","type","submit",1,"submit-button",3,"disabled"],[1,"mfa-setup"],[1,"qr-container"],["alt","QR Code","class","qr-code",3,"src",4,"ngIf"],[1,"setup-instructions"],["alt","QR Code",1,"qr-code",3,"src"]],template:function(i,m){i&1&&(o(0,"div",0)(1,"span",1),r(2,"Two-Factor Authentication"),n(),d(3,j,2,0,"p",2)(4,J,11,1,"div",3),o(5,"form",4),h("ngSubmit",function(){return m.onSubmit()}),o(6,"mat-form-field",5)(7,"mat-label"),r(8,"Authentication Code"),n(),f(9,"input",6),o(10,"mat-hint"),r(11,"Enter the 6-digit code"),n(),d(12,$,2,0,"mat-error",2)(13,K,2,0,"mat-error",2),n(),o(14,"button",7),d(15,W,2,0,"span",2)(16,X,2,1,"span",2),n()()()),i&2&&(a(3),s("ngIf",!m.setupMode),a(),s("ngIf",m.setupMode),a(),s("formGroup",m.mfaForm),a(7),s("ngIf",m.mfaForm.controls.code.hasError("required")),a(),s("ngIf",m.mfaForm.controls.code.hasError("pattern")),a(),s("disabled",m.isLoading||m.mfaForm.invalid),a(),s("ngIf",m.isLoading),a(),s("ngIf",!m.isLoading))},dependencies:[C,v,w,V,y,S,I,T,q,L,A,k,N,P,O,R,B,G,U,Q],styles:[".auth-content[_ngcontent-%COMP%]{font-family:Josephin,sans-serif!important;display:flex;flex-direction:column;text-align:left}h1[_ngcontent-%COMP%]{margin-bottom:8px;font-weight:500}p[_ngcontent-%COMP%]{margin-top:0;margin-bottom:16px;font-size:14px}.form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.submit-button[_ngcontent-%COMP%]{width:100%;background-color:#009c4c;color:#fff;padding:12px;border-radius:4px}.qr-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:16px 0}.qr-code[_ngcontent-%COMP%]{width:180px;height:180px;border:1px solid #eee}.setup-instructions[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:12px;border-radius:4px;font-size:13px;line-height:1.5;margin-bottom:20px}.mfa-setup[_ngcontent-%COMP%]{margin-bottom:16px}"]})};export{z as MfaVerifyComponent};
