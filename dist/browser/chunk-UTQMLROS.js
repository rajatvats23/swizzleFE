import{a as Me,b as Se}from"./chunk-2UETUZ57.js";import{a as ve,c as _e,e as Ce,f as he,g as be,h as D}from"./chunk-EFAJY4UT.js";import"./chunk-2OJIEFOL.js";import{a as oe,b as ae,c as se,d as le,e as me,f as pe,g as de,h as ce,i as ue,j as fe,l as ge}from"./chunk-UAFRLOKJ.js";import"./chunk-3Z3MOL6J.js";import{a as O,c as B,h as P}from"./chunk-QTDDUBQI.js";import{a as ie,b as ne}from"./chunk-SWI6467K.js";import{a as Y,c as Z,d as ee}from"./chunk-2D2I2PDG.js";import{b as Q,c as W,i as X}from"./chunk-PTRNPYW6.js";import{a as re}from"./chunk-URY737FD.js";import{b as V,d as $,g as H,h as L,i as j,k as G,m as q,p as z,s as J,y as K}from"./chunk-NZ7PJTNX.js";import"./chunk-75BXHIVP.js";import{a as I}from"./chunk-5XSEBNVB.js";import{a as U}from"./chunk-4MJ6IACY.js";import{n as te,q as x,u as E}from"./chunk-FE5XWYP3.js";import"./chunk-GTI6TFUP.js";import{Ab as d,Bb as c,Cc as M,Db as A,Fb as u,Gb as h,Kc as S,Oc as k,Rb as o,Sb as _,Ta as s,Tb as b,Ub as N,cb as C,da as F,hb as m,ja as l,ob as p,qa as w,ra as R,xb as n,yb as r,zb as v}from"./chunk-KAD4X6AH.js";var g=class t{http=l(k);baseUrl=`${U.apiUrl}/users`;getUsers(){return this.http.get(this.baseUrl)}getUserById(e){return this.http.get(`${this.baseUrl}/${e}`)}updateUser(e,i){return this.http.put(`${this.baseUrl}/${e}`,i)}deleteUser(e){return this.http.delete(`${this.baseUrl}/${e}`)}inviteAdmin(e){return this.http.post(`${U.apiUrl}/auth/invite`,{email:e})}toggleMfa(e,i){return this.http.put(`${U.apiUrl}/mfa/toggle/${e}`,{enabled:i})}static \u0275fac=function(i){return new(i||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};function ye(t,e){t&1&&(n(0,"mat-error"),o(1,"Email is required"),r())}function we(t,e){t&1&&(n(0,"mat-error"),o(1,"Please enter a valid email"),r())}var T=class t{dialogRef=l(ve);usersService=l(g);authService=l(I);inviteForm=new j({email:new G("",[$.required,$.email])});isLoading=!1;dialogTitle="Invite User";buttonText="Send Invitation";ngOnInit(){let e=this.authService.getCurrentUser();e&&(e.role==="manager"?(this.dialogTitle="Invite Staff Member",this.buttonText="Send Invitation"):(this.dialogTitle="Invite Admin",this.buttonText="Send Invitation"))}onSubmit(){this.inviteForm.valid&&(this.isLoading=!0,this.usersService.inviteAdmin(this.inviteForm.value.email||"").subscribe({next:()=>{this.isLoading=!1,this.dialogRef.close(!0)},error:e=>{this.isLoading=!1,console.error("Error inviting user:",e)}}))}onCancel(){this.dialogRef.close()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=C({type:t,selectors:[["app-invite-dialog"]],decls:15,vars:6,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],["mat-dialog-content",""],["appearance","outline",1,"full-width"],["matInput","","formControlName","email","type","email","placeholder","Enter email address"],[4,"ngIf"],["mat-dialog-actions","","align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(i,a){i&1&&(n(0,"h2",0),o(1),r(),n(2,"form",1),u("ngSubmit",function(){return a.onSubmit()}),n(3,"div",2)(4,"mat-form-field",3)(5,"mat-label"),o(6,"Email"),r(),v(7,"input",4),m(8,ye,2,0,"mat-error",5)(9,we,2,0,"mat-error",5),r()(),n(10,"div",6)(11,"button",7),u("click",function(){return a.onCancel()}),o(12,"Cancel"),r(),n(13,"button",8),o(14),r()()()),i&2&&(s(),_(a.dialogTitle),s(),p("formGroup",a.inviteForm),s(6),p("ngIf",a.inviteForm.controls.email.hasError("required")),s(),p("ngIf",a.inviteForm.controls.email.hasError("email")),s(4),p("disabled",a.inviteForm.invalid||a.isLoading),s(),b(" ",a.isLoading?"Sending...":a.buttonText," "))},dependencies:[S,M,K,q,V,H,L,z,J,D,Ce,be,he,Y,X,Q,W,ee,Z,E,x],styles:[".full-width[_ngcontent-%COMP%]{width:100%}"]})};function Re(t,e){t&1&&(n(0,"th",16),o(1,"Name"),r())}function Ae(t,e){if(t&1&&(n(0,"td",17),o(1),r()),t&2){let i=e.$implicit;s(),N(" ",i.firstName," ",i.lastName," ")}}function Ne(t,e){t&1&&(n(0,"th",16),o(1,"Email"),r())}function $e(t,e){if(t&1&&(n(0,"td",17),o(1),r()),t&2){let i=e.$implicit;s(),_(i.email)}}function Fe(t,e){t&1&&(n(0,"th",16),o(1,"Phone"),r())}function ke(t,e){if(t&1&&(n(0,"td",17),o(1),r()),t&2){let i=e.$implicit;s(),N(" ",i.countryCode," ",i.phoneNumber," ")}}function Oe(t,e){t&1&&(n(0,"th",16),o(1,"Role"),r())}function Be(t,e){if(t&1&&(n(0,"td",17),o(1),r()),t&2){let i=e.$implicit;s(),_(i.role)}}function Pe(t,e){t&1&&(n(0,"th",16),o(1,"MFA"),r())}function Ve(t,e){if(t&1){let i=A();n(0,"td",17)(1,"mat-slide-toggle",18),u("change",function(f){let y=w(i).$implicit,xe=h();return R(xe.toggleMfa(y,f.checked))}),r()()}if(t&2){let i=e.$implicit;s(),p("checked",i.mfaEnabled)("disabled",i.role==="superadmin")}}function He(t,e){t&1&&(n(0,"th",16),o(1,"Actions"),r())}function Le(t,e){if(t&1){let i=A();n(0,"button",20),u("click",function(){w(i);let f=h().$implicit,y=h();return R(y.deleteUser(f))}),n(1,"mat-icon",4),o(2,"delete"),r()()}}function je(t,e){if(t&1&&(n(0,"td",17),m(1,Le,3,0,"button",19),r()),t&2){let i=e.$implicit;s(),p("ngIf",i.role!=="superadmin")}}function Ge(t,e){t&1&&v(0,"tr",21)}function qe(t,e){t&1&&v(0,"tr",22)}var Ie=class t{usersService=l(g);dialog=l(_e);snackBar=l(re);authService=l(I);users=[];displayedColumns=["name","email","phone","role","mfa","actions"];ngOnInit(){this.loadUsers()}loadUsers(){this.usersService.getUsers().subscribe({next:e=>{this.users=e.data.users},error:e=>{console.error("Error loading users:",e)}})}openInviteDialog(){this.dialog.open(T,{width:"400px"}).afterClosed().subscribe(i=>{i&&this.loadUsers()})}toggleMfa(e,i){this.usersService.toggleMfa(e._id,i).subscribe({next:()=>{e.mfaEnabled=i,this.snackBar.open(`MFA ${i?"enabled":"disabled"} for ${e.firstName} ${e.lastName}`,"Close",{duration:3e3})},error:a=>{this.snackBar.open(a.error?.message||"Error toggling MFA","Close",{duration:5e3}),e.mfaEnabled=!i}})}deleteUser(e){confirm(`Are you sure you want to delete ${e.firstName} ${e.lastName}?`)&&this.usersService.deleteUser(e._id).subscribe({next:()=>{this.loadUsers()},error:i=>{console.error("Error deleting user:",i)}})}isManager(){return this.authService.isManager()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=C({type:t,selectors:[["app-users"]],decls:31,vars:4,consts:[[1,"users-container"],[1,"header-actions"],[1,"header-title"],["mat-raised-button","","color","primary",3,"click"],[1,"material-symbols-outlined"],["mat-table","",1,"users-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","phone"],["matColumnDef","role"],["matColumnDef","mfa"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"change","checked","disabled"],["mat-icon-button","","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,a){i&1&&(n(0,"div",0)(1,"div",1)(2,"span",2),o(3,"Users Management"),r(),n(4,"button",3),u("click",function(){return a.openInviteDialog()}),n(5,"mat-icon",4),o(6,"person_add"),r(),o(7),r()(),n(8,"mat-card")(9,"mat-card-content")(10,"table",5),d(11,6),m(12,Re,2,0,"th",7)(13,Ae,2,2,"td",8),c(),d(14,9),m(15,Ne,2,0,"th",7)(16,$e,2,1,"td",8),c(),d(17,10),m(18,Fe,2,0,"th",7)(19,ke,2,2,"td",8),c(),d(20,11),m(21,Oe,2,0,"th",7)(22,Be,2,1,"td",8),c(),d(23,12),m(24,Pe,2,0,"th",7)(25,Ve,2,2,"td",8),c(),d(26,13),m(27,He,2,0,"th",7)(28,je,2,1,"td",8),c(),m(29,Ge,1,0,"tr",14)(30,qe,1,0,"tr",15),r()()()()),i&2&&(s(7),b(" ",a.isManager()?"Invite Staff":"Invite Admin",`
`),s(3),p("dataSource",a.users),s(19),p("matHeaderRowDef",a.displayedColumns),s(),p("matRowDefColumns",a.displayedColumns))},dependencies:[S,M,ge,oe,se,de,le,ae,ce,me,pe,ue,fe,E,x,te,ne,ie,P,O,B,D,Se,Me],styles:[".users-container[_ngcontent-%COMP%]{width:100%}.header-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.users-table[_ngcontent-%COMP%]{width:100%}.mat-mdc-table[_ngcontent-%COMP%]{background-color:var(--secondary-color)!important}"]})};export{Ie as UsersComponent};
